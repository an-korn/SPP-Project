#!/usr/bin/env ruby
require "fileutils"
include FileUtils

ROOT = File.expand_path("..", __dir__)

def system!(*args)
  system(*args) || abort("\n== Command #{args} failed ==")
end

def system(*args)
  puts "> #{args.join(' ')}\n\n"
  super(*args)
end

chdir ROOT do
  system! "docker-compose build"
  system("bin/bundle check") || system!("bin/bundle install --path vendor/bundle")
  system! "bin/rails db:setup"
  # system! "bin/rails log:clear tmp:clear"
  system! "bin/yarn"
end
